customForm.addModule({name:"select",selector:"select",defaultOptions:{showNativeDrop:!1,handleDropPosition:!0,selectDropPosition:"bottom",wrapperClass:"select-area",focusClass:"select-focus",dropActiveClass:"select-active",selectedClass:"item-selected",currentSelectedClass:"current-selected",disabledClass:"select-disabled",valueSelector:"span.center",optGroupClass:"optgroup",openerSelector:"a.select-opener",selectStructure:'<span class="left"></span><span class="center"></span><a class="select-opener"></a>',classPrefix:"select-",dropMaxHeight:200,dropFlippedClass:"select-options-flipped",dropHiddenClass:"options-hidden",dropScrollableClass:"options-overflow",dropClass:"select-options",dropClassPrefix:"drop-",dropStructure:'<div class="drop-holder"><div class="drop-list"></div></div>',dropSelector:"div.drop-list"},checkElement:function(e){return!e.size&&!e.multiple},setupWrapper:function(){customForm.lib.addClass(this.fakeElement,this.options.wrapperClass),this.realElement.parentNode.insertBefore(this.fakeElement,this.realElement),this.fakeElement.innerHTML=this.options.selectStructure,this.fakeElement.style.width=this.realElement.offsetWidth>0?this.realElement.offsetWidth+"px":"auto",customForm.isTouchDevice&&customForm.baseOptions.useNativeDropOnMobileDevices&&(this.options.showNativeDrop=!0),this.options.showNativeDrop&&(this.fakeElement.appendChild(this.realElement),customForm.lib.removeClass(this.realElement,this.options.hiddenClass),customForm.lib.setStyles(this.realElement,{top:0,left:0,margin:0,padding:0,opacity:0,border:"none",position:"absolute",width:customForm.lib.getInnerWidth(this.fakeElement)-1,height:customForm.lib.getInnerHeight(this.fakeElement)-1})),this.opener=customForm.lib.queryBySelector(this.options.openerSelector,this.fakeElement)[0],this.valueText=customForm.lib.queryBySelector(this.options.valueSelector,this.fakeElement)[0],customForm.lib.disableTextSelection(this.valueText),this.opener.customForm=this,this.options.showNativeDrop?this.refreshState():(this.createDropdown(),this.refreshState(),this.onControlReady(this),this.hideDropdown(!0)),this.addEvents()},addEvents:function(){this.options.showNativeDrop?customForm.lib.event.add(this.realElement,"click",this.onChange,this):customForm.lib.event.add(this.fakeElement,"click",this.toggleDropdown,this),customForm.lib.event.add(this.realElement,"change",this.onChange,this)},onFakeClick:function(){},onFocus:function(){customForm.modules[this.name].superclass.onFocus.apply(this,arguments),this.options.showNativeDrop||(customForm.lib.browser.safariMac&&this.realElement.setAttribute("size","2"),customForm.lib.event.add(this.realElement,"keydown",this.onKeyDown,this),customForm.activeControl&&customForm.activeControl!=this&&(customForm.activeControl.hideDropdown(),customForm.activeControl=this))},onBlur:function(){this.options.showNativeDrop?customForm.modules[this.name].superclass.onBlur.apply(this):(customForm.lib.browser.safariMac&&this.realElement.removeAttribute("size"),this.isActiveDrop()&&this.isOverDrop()||(customForm.modules[this.name].superclass.onBlur.apply(this),customForm.activeControl===this&&(customForm.activeControl=null),customForm.isTouchDevice||this.hideDropdown()),customForm.lib.event.remove(this.realElement,"keydown",this.onKeyDown))},onChange:function(){this.refreshState()},onKeyDown:function(e){customForm.tmpFlag=!0,setTimeout(function(){customForm.tmpFlag=!1},100);var i=this;return i.keyboardFix=!0,setTimeout(function(){i.refreshState()},10),13==e.keyCode?(i.toggleDropdown.apply(i),!1):void 0},onResizeWindow:function(){this.isActiveDrop()&&this.hideDropdown()},onScrollWindow:function(){this.isActiveDrop()&&this.positionDropdown()},onOptionClick:function(e){var i=e.target&&e.target.tagName&&"li"==e.target.tagName.toLowerCase()?e.target:customForm.lib.getParent(e.target,"li");return i&&(this.realElement.selectedIndex=parseInt(i.getAttribute("rel")),customForm.isTouchDevice?this.onFocus():this.realElement.focus(),this.refreshState(),this.hideDropdown(),customForm.lib.fireEvent(this.realElement,"change")),!1},onClickOutside:function(e){return customForm.tmpFlag?void(customForm.tmpFlag=!1):void(customForm.lib.isParent(this.fakeElement,e.target)||customForm.lib.isParent(this.selectDrop,e.target)||this.hideDropdown())},onDropHover:function(e){if(this.keyboardFix)this.keyboardFix=!1;else{this.hoverFlag=!0;var i=e.target&&e.target.tagName&&"li"==e.target.tagName.toLowerCase()?e.target:customForm.lib.getParent(e.target,"li");i&&(this.realElement.selectedIndex=parseInt(i.getAttribute("rel")),this.refreshSelectedClass(parseInt(i.getAttribute("rel"))))}},onDropLeave:function(){this.hoverFlag=!1},isActiveDrop:function(){return!customForm.lib.hasClass(this.selectDrop,this.options.dropHiddenClass)},isOverDrop:function(){return this.hoverFlag},createDropdown:function(){this.selectDrop&&this.selectDrop.parentNode.removeChild(this.selectDrop),this.selectDrop=document.createElement("div"),this.selectDrop.className=this.options.dropClass,this.selectDrop.innerHTML=this.options.dropStructure,customForm.lib.setStyles(this.selectDrop,{position:"absolute"}),this.selectList=customForm.lib.queryBySelector(this.options.dropSelector,this.selectDrop)[0],customForm.lib.addClass(this.selectDrop,this.options.dropHiddenClass),document.body.appendChild(this.selectDrop),this.selectDrop.customForm=this,customForm.lib.event.add(this.selectDrop,"click",this.onOptionClick,this),customForm.lib.event.add(this.selectDrop,"mouseover",this.onDropHover,this),customForm.lib.event.add(this.selectDrop,"mouseout",this.onDropLeave,this),this.buildDropdown()},buildDropdown:function(){this.buildDropdownOptions(),this.positionDropdown(),this.buildDropdownScroll()},buildDropdownOptions:function(){this.resStructure="",this.optNum=0;for(var e=0;e<this.realElement.children.length;e++)this.resStructure+=this.buildElement(this.realElement.children[e])+"\n";this.selectList.innerHTML=this.resStructure},buildDropdownScroll:function(){this.options.dropMaxHeight&&this.selectDrop.offsetHeight>this.options.dropMaxHeight&&(this.selectList.style.height=this.options.dropMaxHeight+"px",this.selectList.style.overflow="auto",this.selectList.style.overflowX="hidden",customForm.lib.addClass(this.selectDrop,this.options.dropScrollableClass)),customForm.lib.addClass(this.selectDrop,customForm.lib.getAllClasses(this.realElement.className,this.options.dropClassPrefix,customForm.baseOptions.hiddenClass))},parseOptionTitle:function(e){return"string"==typeof e&&/\.(jpg|gif|png|bmp|jpeg)(.*)?$/i.test(e)?e:""},buildElement:function(e){var t,i="";if("option"==e.tagName.toLowerCase())return customForm.lib.prevSibling(e)&&"option"==customForm.lib.prevSibling(e).tagName.toLowerCase()||(i+="<ul>"),t=this.parseOptionTitle(e.title),i+='<li rel="'+this.optNum++ +'" class="'+(e.className?e.className+" ":"")+'customFormcalc"><a href="#">'+(t?'<img src="'+t+'" alt="" />':"")+"<span>"+e.innerHTML+"</span></a></li>",customForm.lib.nextSibling(e)&&"option"==customForm.lib.nextSibling(e).tagName.toLowerCase()||(i+="</ul>"),i;if("optgroup"==e.tagName.toLowerCase()&&e.label){i+='<div class="'+this.options.optGroupClass+'">',i+='<strong class="customFormcalc"><em>'+e.label+"</em></strong>";for(var s=0;s<e.children.length;s++)i+=this.buildElement(e.children[s]);return i+="</div>"}},positionDropdown:function(){var e=customForm.lib.getOffset(this.fakeElement),i=this.fakeElement.offsetHeight,t=this.selectDrop.offsetHeight,s=e.top-t>=customForm.lib.getScrollTop()&&customForm.lib.getScrollTop()+customForm.lib.getWindowHeight()<e.top+i+t;this.options.handleDropPosition&&s||"top"===this.options.selectDropPosition?(this.selectDrop.style.top=e.top-t+"px",customForm.lib.addClass(this.selectDrop,this.options.dropFlippedClass)):(this.selectDrop.style.top=e.top+i+"px",customForm.lib.removeClass(this.selectDrop,this.options.dropFlippedClass)),this.selectDrop.style.left=e.left+"px",this.selectDrop.style.width=this.fakeElement.offsetWidth+"px"},showDropdown:function(){document.body.appendChild(this.selectDrop),customForm.lib.removeClass(this.selectDrop,this.options.dropHiddenClass),customForm.lib.addClass(this.fakeElement,this.options.dropActiveClass),this.positionDropdown();var e=this.getFakeActiveOption();this.removeClassFromItems(this.options.currentSelectedClass),customForm.lib.addClass(e,this.options.currentSelectedClass),customForm.lib.event.add(window,"resize",this.onResizeWindow,this),customForm.lib.event.add(window,"scroll",this.onScrollWindow,this),customForm.lib.event.add(document,customForm.eventPress,this.onClickOutside,this),this.positionDropdown()},hideDropdown:function(e){this.selectDrop.parentNode&&(this.selectDrop.offsetWidth&&this.selectDrop.parentNode.removeChild(this.selectDrop),e)||("number"==typeof this.origSelectedIndex&&(this.realElement.selectedIndex=this.origSelectedIndex),customForm.lib.removeClass(this.fakeElement,this.options.dropActiveClass),customForm.lib.addClass(this.selectDrop,this.options.dropHiddenClass),customForm.lib.event.remove(window,"resize",this.onResizeWindow),customForm.lib.event.remove(window,"scroll",this.onScrollWindow),customForm.lib.event.remove(document.documentElement,customForm.eventPress,this.onClickOutside),customForm.isTouchDevice&&this.onBlur())},toggleDropdown:function(){this.realElement.disabled||(customForm.isTouchDevice?this.onFocus():this.realElement.focus(),this.dropOpened=!0,this.isActiveDrop()?this.hideDropdown():this.showDropdown(),this.refreshState())},scrollToItem:function(){if(this.isActiveDrop()){var e=this.selectList.offsetHeight,i=this.calcOptionOffset(this.getFakeActiveOption()),t=this.selectList.scrollTop,s=this.getFakeActiveOption().offsetHeight;i>=t+e?this.selectList.scrollTop=i-e+s:t>i&&(this.selectList.scrollTop=i)}},getFakeActiveOption:function(e){return customForm.lib.queryBySelector('li[rel="'+("number"==typeof e?e:this.realElement.selectedIndex)+'"]',this.selectList)[0]},calcOptionOffset:function(e){for(var i=0,t=customForm.lib.queryBySelector(".customFormcalc",this.selectList),s=0;s<t.length&&t[s]!=e;s++)i+=t[s].offsetHeight;return i},childrenHasItem:function(e,t){var s=e.getElementsByTagName("*");for(i=0;i<s.length;i++)if(s[i]==t)return!0;return!1},removeClassFromItems:function(e){for(var i=customForm.lib.queryBySelector("li",this.selectList),t=i.length-1;t>=0;t--)customForm.lib.removeClass(i[t],e)},setSelectedClass:function(e){customForm.lib.addClass(this.getFakeActiveOption(e),this.options.selectedClass)},refreshSelectedClass:function(e){this.options.showNativeDrop||(this.removeClassFromItems(this.options.selectedClass),this.setSelectedClass(e)),this.realElement.disabled?(customForm.lib.addClass(this.fakeElement,this.options.disabledClass),this.labelFor&&customForm.lib.addClass(this.labelFor,this.options.labelDisabledClass)):(customForm.lib.removeClass(this.fakeElement,this.options.disabledClass),this.labelFor&&customForm.lib.removeClass(this.labelFor,this.options.labelDisabledClass))},refreshSelectedText:function(){if(!this.dropOpened&&this.realElement.title)this.valueText.innerHTML=this.realElement.title;else if(this.realElement.options[this.realElement.selectedIndex].title){var e=this.parseOptionTitle(this.realElement.options[this.realElement.selectedIndex].title);this.valueText.innerHTML=(e?'<img src="'+e+'" alt="" />':"")+this.realElement.options[this.realElement.selectedIndex].innerHTML}else this.valueText.innerHTML=this.realElement.options[this.realElement.selectedIndex].innerHTML},refreshState:function(){this.refreshSelectedClass(),this.origSelectedIndex=this.realElement.selectedIndex,this.buildDropdownOptions(),this.options.showNativeDrop||(this.positionDropdown(),this.selectDrop.offsetWidth&&this.scrollToItem()),this.refreshSelectedText(),this.fakeElement.style.width=this.realElement.offsetWidth>0?this.realElement.offsetWidth+"px":"auto"}});